!function e(n,t,r){function o(u,c){if(!t[u]){if(!n[u]){var i="function"==typeof require&&require;if(!c&&i)return i(u,!0);if(s)return s(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var p=t[u]={exports:{}};n[u][0].call(p.exports,function(e){var t=n[u][1][e];return o(t?t:e)},p,p.exports,e,n,t,r)}return t[u].exports}for(var s="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,n,t){"use strict";var r=e("./retry.socket.js"),o=e("./queue/index.js"),s=e("./retry/index.js"),u={extendRapportInstance:function(e){e.constructWebsocket=function(n,t){var u=r(e.Websocket,n,t.protocols,t.connection);return u.setRetryer(s(t.reconnect)),u.setMessageQueue(o(t.reconnect)),u.connect()}}};"undefined"!=typeof window&&(window.RapportReconnect=u),"undefined"!=typeof n&&(n.exports=u)},{"./queue/index.js":2,"./retry.socket.js":4,"./retry/index.js":5}],2:[function(e,n,t){"use strict";var r=e("./simple.queue.js"),o=function(e){if(!e||!e.queueMessages)return null;var n={};if(e.queueMessages===!0?n.type="simple":"string"==typeof e.queueMessages?n.type=e.queueMessages:n=e.queueMessages,n.type&&"simple"!==n.type)throw new TypeError("Invalid message queue type: "+n.type);return r()};n.exports=o},{"./simple.queue.js":3}],3:[function(e,n,t){"use strict";var r=function(){var e={messages:[],push:function(n){e.messages.push(n)},purge:function(){e.messages=[]},flush:function(n){for(;e.messages.length>0;)n(e.messages.shift())}};return e};n.exports=r},{}],4:[function(e,n,t){(function(e){"use strict";var t=("undefined"!=typeof window?window.Rapport:"undefined"!=typeof e?e.Rapport:null).standardize,r=function(e,n,r,o){var s={wsImplementation:e,url:n,protocols:r,connectionOptions:o,instance:null,handlers:{open:function(){},message:function(){},error:function(){},close:function(){}},retryer:null,messageQueue:null,connecting:!1,closed:!1,openCount:0,closeCount:0,setRetryer:function(e){s.retryer=e},setMessageQueue:function(e){s.messageQueue=e},successfullyConnected:function(){s.connecting=!1;var e=0;s.retryer&&(e=s.retryer.attempts,s.retryer.cancel(),s.retryer.reset()),s.messageQueue&&s.messageQueue.flush(s.send),s.openCount++,s.handlers.open({openCount:s.openCount,closeCount:s.closeCount,reconnect:s.openCount>1,retryAttempts:e})},abort:function(e,n){s.connecting=!1,s.messageQueue&&s.messageQueue.purge(),s.handlers.close(e,n)},reconnect:function(e,n){if(s.closed||1e3===e||!s.retryer)return void s.abort(e,n);s.closeCount++;var t=new Error;t.name="RapportReconnect",t.code=e,t.message=n,t.closeCount=s.closeCount,t.openCount=s.openCount,t.retryAttempts=s.retryer.attempts,s.handlers.error(t),s.closed||(s.connecting=!0,s.retryer.attempt(s.connect,s.abort.bind(s,e,n)))},connect:function(){return s.connecting=!0,s.instance=t(new s.wsImplementation(s.url,s.protocols,s.connectionOptions)),s.instance.onOpen(s.successfullyConnected),s.instance.onClose(s.reconnect),s.instance.onMessage(function(e){s.handlers.message(e)}),s.instance.onError(function(e){s.handlers.error(e)}),s},removeEventListener:function(){},on:function(e,n){s.handlers[e]=n},send:function(e){s.connecting?s.messageQueue&&s.messageQueue.push(e):s.instance.send(e)},close:function(e,n){s.closed=!0,s.retryer&&s.retryer.cancel(),s.messageQueue&&s.messageQueue.purge();try{s.instance.close(e,n)}catch(e){}}};return s};n.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,n,t){"use strict";var r=e("./interval.retry.js"),o=function(e){if(!e)return null;var n={};if(e===!0?n.type="interval":"string"==typeof e?n.type=e:n=e,e.type&&"interval"!==e.type)throw new TypeError("Invalid reconnect type: "+n.type);return r(n)};n.exports=o},{"./interval.retry.js":6}],6:[function(e,n,t){"use strict";var r=function(e){var n={attempts:0,maxAttempts:e.maxAttempts||0,interval:e.interval||500,timeout:null,attempt:function(e,t){return n.maxAttempts&&n.attempts>=n.maxAttempts?void t():(n.attempts++,void(n.timeout=setTimeout(e,n.interval)))},reset:function(){n.attempts=0},cancel:function(){n.timeout&&(clearTimeout(n.timeout),n.timeout=null)}};return n};n.exports=r},{}]},{},[1]);
